# 고급 매핑

- 상속 관계 매핑 : 객체의 상속 관계를 데이터베이스에 어떻게 매핑하는지 다룬다
- @MappedSuperclas : 등록일, 수정일 같이 여러 엔티티에서 공통으로 사용하는 매핑 정보만 상속 받고 싶으면 이 기능을 사용하면 된다.
- 복합 키와 식별 관계 매핑 : 데이터베이스의 식별자가 하나 이상일 떄 매핑하는 방법을 다룬다. 그리고 데이터베이스 설계에서 이야기하는 식별 관계와 비식별 관계에 대해서도 다룬다.
- 조인 테이블 : 테이블 외래 키 하나로 연관관계를 맺을 수 있지만 연관관계를 관리하는 연결 테이블을 두는 방법도 있다. 여기서는 이 연결 테이블을 매핑하는 방법을 다룬다.
- 엔티티 하나에 여러 테이블 매핑하기 : 보통 엔티티 하나에 테이블 하나를 매핑하지만 엔티티 하나에 여러 테이블을 매핑하는 방법도 있다 여기서는 이 매핑 방법을 다룬다.

<br/>

<br/>

## 상속 관계 매핑

- 각각 테이블로 변환(조인전략) : 각각을 모두 테이블로 만들고 조회할 때 조인을 사용한다.
- 통합 테이블로 변환(단일 테이블 전략) : 테이블을 하나만 사용해서 통합한다.
- 서브타입 테이블로 변환(구현 클래스마다 테이블 전략) : 서브 타입마다 하나의 테이블을 만든다.

<br/>

#### 1. 조인 전략

**주의점** 

- 테이블은 타입을 구분 못하므로 타입을 구분하는 컬럼이 필요하다.

**장점** 

- 테이블이 정규화 된다.
- 외래 키 참조 무결성 제약조건을 활용할 수 있다.
- 저장공간을 효율적으로 사용한다.

**단점**

- 조회할 때 조인이 많이 사용되므로 성능이 저하될 수 있다.
- 조회 쿼리가 복잡하다.
- 데이터를 등록할 INSERT SQL을 두 번 실행한다.

**특징**

- JPA 표준 명세는 구분 컬럼을 사용하도록 하지만 하이버네이트를 포함한 몇몇 구현체는 구분 컬럼 없이도 동작한다.

#### 2. 단일 테이블 전략

**주의점**

- 자식 엔티티가 매핑한 컬럼은 모두 null을 허용 해야 한다.

**장점**

- 조인이 필요 없으므로 일반적으로 조회 성능이 빠르다
- 조회 쿼리가 단순하다.

**단점**

- 자식 엔티티가 매핑한 컬럼은 모두 null을 허용해야 한다.
- 단일 테이블에 모든 것을 저장하므로 테이블이 커질 수 있다. 그러므로 상황에 따라서는 조회 성능이 오히려 느려질 수 있다.

**특징**

- 구분 컬럼을 꼭 사용해야 한다.

#### 3. 구현 클래스마다 테이블 전략

이 전략은 데이터베이스 설계자와 ORM 전문가 둘다 추천하지 않는 전략 -> 조인이나 단일 테이블 전략 사용

<br/><br/>

## @MappedSuperclass

부모 클래스는 테이블과 매핑하지 않고 부모 클래스를 상속받는 자식 클래스에게 매핑 정보만 제공할때 사용된다. 한마디로 **테이블과 관계가 없고 단순히 엔티티가 공통으로 사용하는 매핑 정보를 모아주는 역할을 할 뿐이다.**

- 테이블과 매핑되지 않고 자식 클래스에 엔티티의 매핑 정보를 상속하기 위해 사용한다.
- @MappedSuperclass로 지정한 클래스는 엔티티가 아니므로 em.find()나 JPQL에서 사용할 수 없다.
- 직접 생성해서 사용할 일은 거의 없으므로 추상 클래스로 만드는 것을 권장한다.

주로 등록일자, 수정일자, 등록자, 수정자 같은 여러 엔티티에서 공통으로 사용하는 속성을 효과적으로 관리할 수 있다.

<br/><br/>

